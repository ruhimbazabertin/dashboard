<!doctype html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Dashboard</title>
    <!--Integrating cdn for datatable-->
    <link rel="stylesheet" 
    type="text/css" 
    href="https://cdn.datatables.net/v/bs4/dt-1.10.25/datatables.min.css" />
  <link rel="stylesheet" 
    href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" 
    integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" 
    crossorigin="anonymous" />
    <!--CHART CDN LINK-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js" integrity="sha512-QSkVNOCYLtj73J4hbmVoOV6KVZuMluZlioC+trLpewV8qMjsWqlIQvkn1KGX2StWvPMdWGBqim1xlC8krl1EKQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <!--End of cdn-->
    <link rel="stylesheet" href="../../css/dashboard.css">
  </head>
  <body>
      <!--NAVBAR COMPONENT-->
    <nav class="navbar navbar-dark fixed-top bg-primary flex-md-nowrap p-0 shadow">
        <a class="navbar-brand col-sm-3 col-md-2 mr-0" th:href="@{/dashboard/user/index}">User Dashboard</a>
      <!-- <form th:action="@{/student/index}" method="get"> -->
         <!-- <input type="text" id="search" name="keyword" class="form-control form-control-primary w-100" placeholder="Search..." >  --> 
         <!-- </form> -->
<div class="btn-group" style="margin-right: 50px;">
  <button type="button" class="btn btn-warning dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
    <span th:text="${#authentication.getPrincipal().getUsername()}"></span>
  </button>
  <div class="dropdown-menu">
    <a class="dropdown-item" th:href="@{/user/profile}">Profile</a>
    <a class="dropdown-item" href="#">Settings</a>
    <div class="dropdown-divider"></div>
     <a class="nav-link" th:href="@{/logout}">Logout</a>
  </div>
</div>
    </nav>
    
    <!--SIDE MENU-->
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-2 bg-light d-none d-md-block sidebar">
                <div class="left-sidebar">
                    <ul class="nav flex-column sidebar-nav">
                        <li class="nav-item">
                          <a class="nav-link active" th:href="@{/dashboard/user/index}">
                            <svg class="bi bi-chevron-right" width="16" height="16" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M6.646 3.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L12.293 10 6.646 4.354a.5.5 0 010-.708z" clip-rule="evenodd"/></svg>
                            Dashboard
                          </a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" th:href="@{/faculty/form}">
                            <svg class="bi bi-chevron-right" width="16" height="16" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M6.646 3.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L12.293 10 6.646 4.354a.5.5 0 010-.708z" clip-rule="evenodd"/></svg>
                            Faculty
                          </a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" th:href="@{/department/form}">
                            <svg class="bi bi-chevron-right" width="16" height="16" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M6.646 3.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L12.293 10 6.646 4.354a.5.5 0 010-.708z" clip-rule="evenodd"/></svg>
                            Department
                          </a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" th:href="@{/course/index}">
                            <svg class="bi bi-chevron-right" width="16" height="16" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M6.646 3.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L12.293 10 6.646 4.354a.5.5 0 010-.708z" clip-rule="evenodd"/></svg>
                            Course
                          </a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" th:href="@{/student/index}">
                            <svg class="bi bi-chevron-right" width="16" height="16" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M6.646 3.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L12.293 10 6.646 4.354a.5.5 0 010-.708z" clip-rule="evenodd"/></svg>
                            student
                          </a>
                        </li>
                        <li class="nav-item">
                          <a class="nav-link" th:href="@{/teacher/index}">
                            <svg class="bi bi-chevron-right" width="16" height="16" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M6.646 3.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L12.293 10 6.646 4.354a.5.5 0 010-.708z" clip-rule="evenodd"/></svg>
                            teacher
                          </a>
                        </li>
                      </ul>
                </div>
              </div>
        </div>
      </div>
      <!--MAIN SECTION-->
      <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
          <h2>Welcome to admin dashboard</h2>
          <hr/>
        <div class="row" style="margin-left: 400px;">  <h3>Dashboard Review</h3> </div>
<hr>
<div class="row">
  <div class="col-4">
    <a th:href="@{/course/index}" style="text-decoration: none;">
      <div class="card border-primary mb-4">
          <div class="card-body text-warning">
              <h5 class="card-title">Number of courses available</h5>
              <p class="card-text" style="color: black;">Number: <strong><span th:text="${totalOfCourseAvailable}"></span></strong></p>
          </div>
      </div>
      </a>
  </div>
  <div class="col-4">
    <a th:href="@{/student/index}" style="text-decoration: none;">
      <div class="card border-primary mb-4">
          <div class="card-body text-warning">
              <h5 class="card-title">Number of students available</h5>
              <p class="card-text" style="color: black;">Number: <strong><span th:text="${totalOfStudentAvailable}"></span></strong></p>
          </div>
      </div>
      </a>
  </div>
  <div class="col-4">
    <a href="#" style="text-decoration: none;">
      <div class="card border-primary mb-4">
          <div class="card-body text-warning">
              <h5 class="card-title">Number of Users available</h5>
              <p class="card-text" style="color: black;">Number: <strong><span th:text="${totalOfUserAvailable}"></span></strong></p>
          </div>
      </div>
      </a>
  </div>
  <hr/>
  <!--CHART HERE-->
  <div>
    <canvas id="myChart" width="400" height="400"></canvas>
    </div>
     <!--END OF CHART-->
  <!--IMPLEMENTATION OF PIE CHART-->
  <div id="chart" style="position: relative; top:-100px; margin-left: 200px;">
    <canvas id="chart" width="500"></canvas>
    </div>
    <hr/>
  <!--END OF PIE CHART-->
  <!--USERS INFO-->
  <button type="button" class="btn btn-primary btn btn-block" data-toggle="modal" data-target=""><a style="text-decoration: none;" href=""><span style="color: white;">Create New User</span></a></button>
  <div class="container">
  <div class="users">
    <div class="table-responsive">
      <table class="table table-bordered table-striped" id="userTable">
        <thead>
          <tr>
            <th>#</th>
            <th>FirstName</th>
            <th>LastName</th>
            <th>Email</th>
            <th>Role</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="user: ${users}">
            <td th:text="${user.id}"></td>
            <td th:text="${user.firstName}"></td>
            <td th:text="${user.lastName}"></td>
           
            <td th:text="${user.email}"></td>
            <td th:text="${user.roles}"></td>
            <td>
              <button type="button" class="btn btn-primary" style="color: white;"><a id="editUserButton" th:href="@{/dashboard/users/edit/{id}(id=${user.id})}" style="text-decoration: none;"><span style="color: white;">Edit</span></a></button>
             <button type="button" class="btn btn-danger"> <a id="deleteButton" th:href="@{/dashboard/users/delete/{id}(id=${user.id})}" style="text-decoration: none;"><span style="color: white;">Delete</span></a></button>
          </td>
          </tr>
          </form>
          <!--END-->
  
        </tbody>
      </table>
    </div>
     <!--MODEL FOR DELETING A USER-->
     <div id="deleteModel" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content border-0">
              <div class="modal-body p-0">
                  <div class="card border-0 p-sm-3 p-2 justify-content-center">
                      <div class="card-header pb-0 bg-white border-0 ">
                          <div class="row">
                              <div class="col ml-auto"><button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div>
                          </div>
                          <p class="font-weight-bold mb-2"> Are you sure you wanna delete this record ?</p>
                      </div>
                      <div class="card-body px-sm-4 mb-2 pt-1 pb-0">
                          <div class="row justify-content-end no-gutters">
                              <div class="col-auto"><button type="button" class="btn btn-light text-muted" data-dismiss="modal">Cancel</button></div>
                              <div class="col-auto"><a href="" class="btn btn-danger px-4" id="delRef">Confirm Delete</a></div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>
</div>
<!--END OF MODEL FOR DELETING-->
<!-- MODEL FOR EDITING A USER -->
<div class="modal fade" id="editUserModel" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">     <div class="row">  <h3>Edit User</h3> </div></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!--COURSE FORM-->
        <div class="row">
          <div class="col-md-10">
              <form th:action="@{/dashboard/users/update}" method="post" class="needs-validation" novalidate>
                <!--set student ID in input-->
                <input type="" class="form-control"  id="user_id" name="id">
                  <div class="row form-group">
                      <div class="col-md-4">
                          <label for="firstname">FirstName</label>
                          </div>
                          <div class="col-md-6">
                              <input type="text" class="form-control" id="first_name" name="firstName" required>
                              <div class="invalid-feedback">
                                Please fill out this FirstName field.
                              </div>
                              </div>
                      </div>
                      <div class="row form-group">
                          <div class="col-md-4">
                              <label for="lastname">LastName</label>
                              </div>
                              <div class="col-md-6">
                                  <input type="text" class="form-control" id="last_name" name="lastName" required>
                                  <div class="invalid-feedback">Please fill out this lastName field.</div>
                                  </div>
                          </div>
                          <div class="row form-group">
                              <div class="col-md-4">
                                  <label for="gender">Gender</label>
                                  </div>
                                  <div class="col-md-6" id="user_gender">
                                      <input type="radio" name="gender" value="male"> Male
                                      <input type="radio" name="gender" value="female"> Female
                                      <input type="radio" name="gender" value="other"> Other
                                      <div class="invalid-feedback">Please select Gender.</div>
                                      </div>
                              </div>

                                  <div class="row form-group">
                                      <div class="col-md-4">
                                          <label for="Address">Email</label>
                                          </div>
                                          <div class="col-md-6">
                                              <input type="text" id="email" name="email" class="form-control" required>
                                              <div class="invalid-feedback">Please fill out this email field.</div>
                                              </div>
                                      </div>
                                      <div class="row form-group">
                                        <div class="col-md-4">
                                            <label for="Role">Role</label>
                                            </div>
                                            <div class="col-md-6">
                                                <input type="text" id="role" name="roles" class="form-control" required>
                                                <div class="invalid-feedback">Please fill out this role field.</div>
                                                </div>
                                        </div>
                                  </div>
                                  <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <button type="submit" class="btn btn-primary">Save changes</button>
                                  </div>
                  </form>
              </div>
          </div>
      </div>

    </div>
  </div>
</div>
  <!--END OF MODEL FOR EDITING USER-->
    </div>
    </div>
    <!--END-->
      </main>
      <!--END MAIN SECTION-->
      <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
           <!--pagination, sort and filtering table-->
      <script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.10.25/datatables.min.js"></script>
    <!--CDN FOR PIE-->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <!--Starting of chart script here-->
     <script type="text/javascript" th:inline="javascript">
     let departNames = [[${departNames}]];
    let studentNo = [[${studentNumberOnEachDepart}]];
    const ctx = document.getElementById('myChart').getContext('2d');

const myChart = new Chart(ctx, {       
    type: 'bar',
    data: {
        labels: departNames,
        datasets: [{
            label: '# of students',
            data: studentNo,
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});
</script>
<!--SCRIPT FOR PIE CHART-->
<script type="text/javascript" th:inline="javascript">
   let courseNumber = [[${coursesNumberOnEachDepart}]];
var options = {
  series: courseNumber,
  chart: {
  type: 'donut',
},
labels: departNames,
responsive: [{
  breakpoint: 480,
  options: {
    chart: {
      width: 200
    },
    legend: {
      position: 'bottom'
    }
  }
}]
};

var chart = new ApexCharts(document.querySelector("#chart"), options);
chart.render();
</script>
<!--END SCRIPT-->
<!--Javascript for editing  user-->
<script>
  $('.table #editUserButton').on('click', function(event){
    event.preventDefault();
    var href = $(this).attr('href');
    console.log(href);
      $.get(href, function(user, status){
        console.log(user)
       $("#user_id").val(user.id);
       console.log("ID"+user.id);
        $("#first_name").val(user.firstName);
        console.log("UserFirstName:"+user.firstName)
        $("#last_name").val(user.lastName);
        $("#user_gender").val(user.gender);
        $("#email").val(user.email);
        $("#role").val(user.roles[0].name);

      });
    $('#editUserModel').modal();
    console.log("UserFirstName:"+user.firstName)
    console.log("ROLE:"+user.roles);
  });
</script>
<!--SCRIPT FOR DELETE-->
<script>
          $('.table #deleteButton').on('click', function(event){
            event.preventDefault();
            var href = $(this).attr('href');
            $('#deleteModel #delRef').attr('href', href);
            $('#deleteModel').modal();

          });
  </script>
<!--END OF SCRIPT-->
<!--BOOTSTRAP VALIDATION FOR USER-->
<script>
  // JavaScript for disabling form submissions if there are invalid fields
  (function() {
    'use strict';
    window.addEventListener('load', function() {
      // Fetch all the forms we want to apply custom Bootstrap validation styles to
      var forms = document.getElementsByClassName('needs-validation');
      // Loop over them and prevent submission
      var validation = Array.prototype.filter.call(forms, function(form) {
        form.addEventListener('submit', function(event) {
          if (form.checkValidity() === false) {
            event.preventDefault();
            event.stopPropagation();
          }
          form.classList.add('was-validated');
        }, false);
      });
    }, false);
  })();
  </script>
<!--END OF SCRIPT-->
  </body>
</html>